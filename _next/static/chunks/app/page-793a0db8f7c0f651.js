(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4207:function(e,t,l){Promise.resolve().then(l.bind(l,4825))},4825:function(e,t,l){"use strict";l.d(t,{default:function(){return P}});var o=l(7437),n=l(2265),r=l(5990),a=l(625),s=l(8364),i=l(2218),d=l(4839),c=l(6164);function u(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];return(0,c.m6)((0,d.W)(t))}let p=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),m=n.forwardRef((e,t)=>{let{className:l,...n}=e;return(0,o.jsx)(s.f,{ref:t,className:u(p(),l),...n})});m.displayName=s.f.displayName;let f=n.forwardRef((e,t)=>{let{className:l,type:n,...r}=e;return(0,o.jsx)("input",{type:n,className:u("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",l),ref:t,...r})});f.displayName="Input";let g=n.forwardRef((e,t)=>{let{className:l,...n}=e;return(0,o.jsx)("textarea",{className:u("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",l),ref:t,...n})});g.displayName="Textarea";var x=l(2974);let b=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),h=n.forwardRef((e,t)=>{let{className:l,variant:n,size:r,asChild:a=!1,...s}=e,i=a?x.g7:"button";return(0,o.jsx)(i,{className:u(b({variant:n,size:r,className:l})),ref:t,...s})});h.displayName="Button";let y=n.forwardRef((e,t)=>{let{className:l,...n}=e;return(0,o.jsx)("div",{ref:t,className:u("rounded-lg border bg-card text-card-foreground shadow-sm",l),...n})});y.displayName="Card";let v=n.forwardRef((e,t)=>{let{className:l,...n}=e;return(0,o.jsx)("div",{ref:t,className:u("flex flex-col space-y-1.5 p-6",l),...n})});v.displayName="CardHeader",n.forwardRef((e,t)=>{let{className:l,...n}=e;return(0,o.jsx)("h3",{ref:t,className:u("text-2xl font-semibold leading-none tracking-tight",l),...n})}).displayName="CardTitle",n.forwardRef((e,t)=>{let{className:l,...n}=e;return(0,o.jsx)("p",{ref:t,className:u("text-sm text-muted-foreground",l),...n})}).displayName="CardDescription";let w=n.forwardRef((e,t)=>{let{className:l,...n}=e;return(0,o.jsx)("div",{ref:t,className:u("p-6 pt-0",l),...n})});w.displayName="CardContent";let j=n.forwardRef((e,t)=>{let{className:l,...n}=e;return(0,o.jsx)("div",{ref:t,className:u("flex items-center p-6 pt-0",l),...n})});j.displayName="CardFooter";var N=l(9905);let C=n.forwardRef((e,t)=>{let{className:l,value:n,...r}=e;return(0,o.jsx)(N.fC,{ref:t,className:u("relative h-4 w-full overflow-hidden rounded-full bg-secondary",l),...r,children:(0,o.jsx)(N.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});C.displayName=N.fC.displayName;let k=[{inputs:[{internalType:"string",name:"_title",type:"string"},{internalType:"string[]",name:"_options",type:"string[]"}],name:"createPoll",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_pollId",type:"uint256"}],name:"getPollOptions",outputs:[{internalType:"string[]",name:"",type:"string[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_pollId",type:"uint256"},{internalType:"string",name:"_option",type:"string"}],name:"getPollVotes",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"pollCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"polls",outputs:[{internalType:"string",name:"title",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_pollId",type:"uint256"},{internalType:"string",name:"_option",type:"string"}],name:"vote",outputs:[],stateMutability:"nonpayable",type:"function"}];function P(){let[e,t]=(0,n.useState)(null),[l,s]=(0,n.useState)(null),[i,d]=(0,n.useState)(null),[c,u]=(0,n.useState)([]),[p,x]=(0,n.useState)(""),[b,N]=(0,n.useState)(""),[P,S]=(0,n.useState)(""),[E,_]=(0,n.useState)(!1),[F,M]=(0,n.useState)(""),[R,z]=(0,n.useState)("");(0,n.useEffect)(()=>{void 0!==window.ethereum&&t(new r.Q(window.ethereum))},[]);let O=async()=>{if(e)try{console.log("Connecting wallet...");let t=await e.getSigner();console.log("Signer obtained");let l=new a.CH("0x3da8ea380Fc9bEe79E8016b7Ade75B94795eE595",k,t);console.log("Contract instance created"),s(t),d(l);let o=await t.getAddress();console.log("Connected wallet address:",o),x(o),await A(l)}catch(e){W(e,"Failed to connect wallet")}else console.error("Provider not available"),z("Provider not available. Please make sure you have MetaMask installed and try again.")},A=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e||i;if(t)try{z(""),console.log("Starting to load polls...");let e=await t.pollCount();console.log("Poll count:",e.toString());let l=[];for(let o=1;o<=e;o++){console.log("Loading poll ".concat(o,"..."));try{let e=await t.polls(o);console.log("Poll ".concat(o," title:"),e.title);let n=await t.getPollOptions(o);console.log("Poll ".concat(o," options:"),n);let r=await Promise.all(n.map(async e=>{let l=await t.getPollVotes(o,e);return console.log("Poll ".concat(o,', Option "').concat(e,'" votes:'),l.toString()),l.toNumber()}));l.push({id:o,title:e.title,options:n,votes:r})}catch(e){console.error("Error loading poll ".concat(o,":"),e)}}console.log("All polls loaded:",l),u(l)}catch(e){W(e,"Failed to load polls")}else console.error("Contract is not initialized"),z("Contract is not initialized. Please connect your wallet.")},V=async e=>{if(e.preventDefault(),console.log("Create Poll button clicked"),!p){z("Please connect your wallet first");return}if(!i){z("Contract is not initialized. Please try reconnecting your wallet.");return}if(!b||!P){z("Please enter both a title and options for the poll");return}try{z(""),console.log("Creating poll with title:",b),console.log("Poll options:",P);let e=P.split(",").map(e=>e.trim());console.log("Processed options:",e),console.log("Calling contract.createPoll");let t=await i.createPoll(b,e);console.log("Transaction sent:",t.hash),console.log("Waiting for transaction to be mined"),await t.wait(),console.log("Transaction mined"),N(""),S(""),console.log("Form reset"),await A(),console.log("Polls reloaded")}catch(t){console.error("Failed to create poll:",t);let e="Failed to create poll: Unknown error";t instanceof Error?(e="Failed to create poll: ".concat(t.message),console.error("Error message:",t.message),"reason"in t&&console.error("Error reason:",t.reason),"code"in t&&console.error("Error code:",t.code)):"string"==typeof t&&(e="Failed to create poll: ".concat(t)),z(e)}},W=(e,t)=>{console.error(t,e),e instanceof Error?z("".concat(t,": ").concat(e.message)):z("".concat(t,": An unknown error occurred"))},I=async(e,t)=>{if(i)try{z("");let l=await i.vote(e,t);await l.wait(),await A()}catch(e){W(e,"Failed to cast vote")}};return(0,o.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-[#f0f0f0] dark:bg-[#1a1b1e]",children:(0,o.jsxs)("div",{className:"w-full max-w-4xl mx-4 sm:mx-8 md:mx-12 lg:mx-16 xl:mx-20 2xl:mx-24",children:[(0,o.jsxs)("header",{className:"flex items-center justify-between py-4 border-b border-[#e0e0e0] dark:border-[#2c2d30]",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)(T,{className:"w-8 h-8 text-[#0077b6]"}),(0,o.jsx)("h1",{className:"text-2xl font-bold text-[#0077b6]",children:"Manta Polls"})]}),p?(0,o.jsxs)("div",{className:"text-sm text-[#0077b6]",children:["Connected Wallet: ",(0,o.jsx)("span",{className:"font-bold",children:p}),(0,o.jsx)("br",{}),"Network: ",(0,o.jsx)("span",{className:"font-bold",children:F})]}):(0,o.jsx)(h,{onClick:O,disabled:E,className:"bg-[#0077b6] text-white hover:bg-[#005a8f]",children:E?"Connecting...":"Connect Wallet"})]}),R&&(0,o.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-4",role:"alert",children:[(0,o.jsx)("strong",{className:"font-bold",children:"Error: "}),(0,o.jsx)("span",{className:"block sm:inline",children:R})]}),(0,o.jsxs)("main",{className:"py-8",children:[(0,o.jsxs)("section",{className:"mb-8",children:[(0,o.jsx)("h2",{className:"text-xl font-bold mb-4 text-[#0077b6]",children:"Create Poll"}),(0,o.jsxs)("form",{onSubmit:V,className:"bg-white dark:bg-[#2c2d30] rounded-lg shadow-md p-6",children:[(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)(m,{htmlFor:"title",children:"Poll Title"}),(0,o.jsx)(f,{id:"title",value:b,onChange:e=>N(e.target.value),placeholder:"Enter poll title"})]}),(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)(m,{htmlFor:"options",children:"Poll Options"}),(0,o.jsx)(g,{id:"options",value:P,onChange:e=>S(e.target.value),placeholder:"Enter poll options separated by commas",className:"min-h-[100px]"})]}),(0,o.jsx)(h,{type:"submit",className:"bg-[#0077b6] text-white hover:bg-[#005a8f] w-full",children:"Create Poll"})]})]}),(0,o.jsxs)("section",{children:[(0,o.jsx)("h2",{className:"text-xl font-bold mb-4 text-[#0077b6]",children:"Polls"}),(0,o.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:c.map(e=>(0,o.jsxs)(y,{className:"bg-white dark:bg-[#2c2d30] rounded-lg shadow-md",children:[(0,o.jsx)(v,{className:"border-b border-[#e0e0e0] dark:border-[#2c2d30] p-4",children:(0,o.jsx)("h3",{className:"text-lg font-bold text-[#0077b6]",children:e.title})}),(0,o.jsx)(w,{className:"p-4",children:e.options.map((t,l)=>(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsx)("span",{children:t}),(0,o.jsx)("span",{className:"font-bold",children:e.votes[l]})]}),(0,o.jsx)(C,{value:e.votes[l],max:e.votes.reduce((e,t)=>e+t,0),className:"h-2 bg-[#0077b6]"})]},l))}),(0,o.jsx)(j,{className:"border-t border-[#e0e0e0] dark:border-[#2c2d30] p-4",children:(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsxs)("select",{onChange:t=>I(e.id,t.target.value),className:"bg-[#0077b6] text-white hover:bg-[#005a8f] p-2 rounded",children:[(0,o.jsx)("option",{value:"",children:"Select an option"}),e.options.map((e,t)=>(0,o.jsx)("option",{value:e,children:e},t))]}),(0,o.jsxs)("div",{className:"text-sm text-[#0077b6] font-bold",children:["Total Votes: ",e.votes.reduce((e,t)=>e+t,0)]})]})})]},e.id))})]})]}),(0,o.jsx)("footer",{className:"flex items-center justify-between py-4 border-t border-[#e0e0e0] dark:border-[#2c2d30]",children:(0,o.jsx)("div",{children:(0,o.jsx)("div",{className:"text-[#0077b6]"})})})]})})}function T(e){return(0,o.jsxs)("svg",{...e,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,o.jsx)("rect",{x:"16",y:"16",width:"6",height:"6",rx:"1"}),(0,o.jsx)("rect",{x:"2",y:"16",width:"6",height:"6",rx:"1"}),(0,o.jsx)("rect",{x:"9",y:"2",width:"6",height:"6",rx:"1"}),(0,o.jsx)("path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3"}),(0,o.jsx)("path",{d:"M12 12V8"})]})}}},function(e){e.O(0,[644,971,23,744],function(){return e(e.s=4207)}),_N_E=e.O()}]);